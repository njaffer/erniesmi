
  <% @category = @category.gsub("''", "'")  %>
  <% @category1 = @category1.gsub("''", "'")  %>
  <% @category2 = @category2.gsub("''", "'")  %>
  <% @category3 = @category3.gsub("''", "'")  %>
  <% @category4 = @category4.gsub("''", "'")  %>
  <% @category5 = @category5.gsub("''", "'")  %>
  <% @category6 = @category6.gsub("''", "'")  %>
  <% @category7 = @category7.gsub("''", "'")  %>
  <% @category8 = @category8.gsub("''", "'")  %>
  <% @category9 = @category9.gsub("''", "'")  %>

<div class="container">
	<h2>Advanced Search</h2>
  <% base_url = "https://ernie-tpics.s3.amazonaws.com/" %> 
  <% access_level = check_current_access %>
  <div class="card" style=" margin-top: 10px; margin-bottom: 20px; padding-top: 15px; background-color: #F5F5F5;">
	<%= form_tag(advanced_search_archives_path, :enctype =>"multipart/form-data") do %>
  <div class="form-group">
    <div class="row ml-1">
       <div class="col-sm-1">
         <p> Keywords:</p>
        </div>  
      <div class="col-sm-11" align="left">
     <%= text_field_tag :searchterm, @searchterm, :size=> 40 %> <%= select_tag "con011", options_for_select(@connector,@con011)  %> 
     &nbsp; Year: <%= text_field_tag :lyear, @lyear, :size=> 10 %> <%= select_tag "con111", options_for_select(@connector,@con111)  %> 
     </div> 
   </div>
    <div class="row ml-1">
    <div class="col-sm-1">
     <%= label_tag :county %>
   </div>
   <div class="col-sm-11" align="left">

     <%= select_tag :county , options_from_collection_for_select(@acounty, "name", "name", @county), :include_blank => true   %> <%= select_tag "con1", options_for_select(@connector,@con1)  %> 
      <%= select_tag :county1 , options_from_collection_for_select(@acounty, "name", "name", @county1), :include_blank => true   %> <%= select_tag "con11", options_for_select(@connector,@con11)  %> 
       <%= select_tag :county2 , options_from_collection_for_select(@acounty, "name", "name", @county2), :include_blank => true   %> <%= select_tag "con12", options_for_select(@connector,@con12)  %> 
        <%= select_tag :county3 , options_from_collection_for_select(@acounty, "name", "name", @county3), :include_blank => true   %> <%= select_tag "con13", options_for_select(@connector,@con13)  %> 
    </div>
    </div>

    <div class="row ml-1">
    <div class="col-sm-1" align="left">
     <%= label_tag :city %>
    </div> 
    <div class="col-sm-11" align="left"> 
     <%= select_tag :city, options_from_collection_for_select(@acity, "name", "name", @city), :include_blank => true  %> <%= select_tag "con2", options_for_select(@connector,@con2)  %><%= select_tag :city1, options_from_collection_for_select(@acity, "name", "name", @city1), :include_blank => true  %> <%= select_tag "con21", options_for_select(@connector,@con21)  %><%= select_tag :city2, options_from_collection_for_select(@acity, "name", "name", @city2), :include_blank => true  %> <%= select_tag "con22", options_for_select(@connector,@con22)  %><%= select_tag :city3, options_from_collection_for_select(@acity, "name", "name", @city3), :include_blank => true  %> <%= select_tag "con23", options_for_select(@connector,@con23)  %>
    </div>
    </div>

    <div class="row ml-1">
    <div class="col-sm-1" align="left">
     <%= label_tag :category %>
    </div>
    <div class="col-sm-11" align="left"> 
     <%= select_tag :category, options_from_collection_for_select(@acategory, "name", "name", @category) , :include_blank => true  %> <%= select_tag "con3", options_for_select(@connector,@con3)  %> 
     <%= select_tag :category1, options_from_collection_for_select(@acategory, "name", "name", @category1) , :include_blank => true  %><%= select_tag "con31", options_for_select(@connector,@con31)  %> 
     <%= select_tag :category2, options_from_collection_for_select(@acategory, "name", "name", @category2) , :include_blank => true  %><%= select_tag "con32", options_for_select(@connector,@con32)  %> 
      <%= select_tag :category3, options_from_collection_for_select(@acategory, "name", "name", @category3) , :include_blank => true  %><%= select_tag "con33", options_for_select(@connector,@con33)  %> 
     <%= select_tag :category4, options_from_collection_for_select(@acategory, "name", "name", @category4) , :include_blank => true  %> <%= select_tag "con34", options_for_select(@connector,@con34)  %> 
     <%= select_tag :category5, options_from_collection_for_select(@acategory, "name", "name", @category5) , :include_blank => true  %><%= select_tag "con35", options_for_select(@connector,@con35)  %> 
     <%= select_tag :category6, options_from_collection_for_select(@acategory, "name", "name", @category6) , :include_blank => true  %><%= select_tag "con36", options_for_select(@connector,@con36)  %>
      <%= select_tag :category7, options_from_collection_for_select(@acategory, "name", "name", @category7) , :include_blank => true  %><%= select_tag "con37", options_for_select(@connector,@con37)  %> 
      <%= select_tag :category8, options_from_collection_for_select(@acategory, "name", "name", @category8) , :include_blank => true  %><%= select_tag "con38", options_for_select(@connector,@con38)  %>
      <%= select_tag :category9, options_from_collection_for_select(@acategory, "name", "name", @category9) , :include_blank => true  %>
    </div>
     </div>
     <% if (access_level==1) %> 
     <div class="row ml-1">
    <div class="col-sm-1" align="left">
      Status:
    </div>  
     <div class="col-sm-11" align="left"> 
       <% if (params["yes"]) %>
       <%= check_box_tag :yes, 1, true %>
       <% else %>
       <%= check_box_tag (:yes) %>
       <% end %>
       <%= label_tag(:yes, "Active") %> &nbsp;&nbsp;&nbsp;&nbsp;
       <% if (params["no"]) %>
       <%= check_box_tag :no, 1, true %>
       <% else %>
       <%= check_box_tag (:no) %>
       <% end %>
       <%= label_tag(:no, "Inactive") %>
     </div>
    </div>
    <div class="row ml-1">
    <div class="col-sm-1" align="left">
      ID: 
    </div>  
    <div class="col-sm-5" align="left">  
      <%= text_field_tag :itemid_new, "" %>
    </div>
     <div class="col-sm-6" align="left"> 
     Old ID: <%= text_field_tag :itemid, "" %>
     </div> 
   </div>

    <% end %>
  </div>
  <div class="form-group">
    <div class="col-sm-offset-2 col-sm-10">
      <button type="submit" class="btn btn-primary">Search Archives</button> 
      <%#<button type="Reset" class="btn btn-secondary">Reset Form</button> %>&nbsp;
       <%= link_to 'New Search', advanced_search_archives_path %>
       </div>
  </div>
<% end %>
</div>
<% if (!@archives.nil?) %>
<h4 style="margin-left: 10px; margin-top: 10px;">  <%= @total_archives_count %> archives found </h4>
<% @archives.each do |a| %>
<% 
  ppath = a.path

  if (ppath.eql? "Tpics")
    ppath = "tpics"
  end  

if (a.fname.nil?)
    fname_url = "https://ernie-tpics.s3.amazonaws.com/ernie.png"
  elsif ppath.length==0
        fname_url = base_url+ a.fname 
   else 
    fname_url = base_url+ ppath + "/"+ a.fname 
   end 
%>
<% url = image_url(fname_url)%>


<div class="card" style="width: 100%;">
  <div class="card-title">
    
  </div>  
   <div class="card-body">
    <div class="row">
      <div class="col-2">
        <p>
          <%= link_to image_tag(url, style: 'height:40%;width:40%;'), letter_archives_path(:id => a.id, :b=>"0") %>
        </p>
        <% if (access_level==1) %>
          <p> <%= link_to "Edit", edit_archives_path(:id => a.id)  %></p>
        <% end %>  

      </div>
      <div class="col-10">  
      <p class="card-title"><b>Title:</b> <%=a.caption%>  <%= link_to " More..", letter_archives_path(:id => a.id, :b=>"0")  %>
      <br>
      <b>Year:</b> <%= a.pyear %> <br>
      <b>Date:</b> <%= a.pdate %> <br>
      <b>County:</b> 
        
        <% if ((!a.county1.eql? "") && (!a.county1.eql? nil))%>
          <%= link_to a.county1, search_archives_path(:county => a.county1)  %>
        <%end%> 
        <% if ((!a.county2.eql? "") && (!a.county2.eql? nil)) %>, 
          <%= link_to a.county2, search_archives_path(:county => a.county2)  %> 
        <%end%>
        <% if ((!a.county3.eql? "") && (!a.county3.eql? nil)) %>,
          <%= link_to a.county3, search_archives_path(:county => a.county3)  %>
        <%end%> 
         <% if ((!a.county4.eql? "") && (!a.county4.eql? nil)) %>
          <%= link_to a.county4, search_archives_path(:county => a.county4)  %>
        <%end%> 
        <% if ((!a.county5.eql? "") && (!a.county5.eql? nil))%>, 
          <%= link_to a.county5, search_archives_path(:county => a.county5)  %> 
        <%end%>
        <% if ((!a.county6.eql? "") && (!a.county6.eql? nil)) %>,
          <%= link_to a.county6, search_archives_path(:county => a.county6)  %>
        <%end%> 
         <%if ((!a.county7.eql? "") && (!a.county7.eql? nil)) %>
          <%= link_to a.county7, search_archives_path(:county => a.county7)  %>
        <%end%> 
        <% if ((!a.county8.eql? "") && (!a.county8.eql? nil)) %>, 
          <%= link_to a.county8, search_archives_path(:county => a.county8)  %> 
        <%end%>
        <% if ((!a.county9.eql? "") && (!a.county9.eql? nil))%>,
          <%= link_to a.county9, search_archives_path(:county => a.county9)  %>
        <%end%> 
        <% if ((!a.county10.eql? "") && (!a.county10.eql? nil)) %>,
          <%= link_to a.county10, search_archives_path(:county => a.county10)  %>
        <%end%> 
        <br>
      <b>City:</b> 
        <%=a.city1 %> <% if ((!a.city2.eql? "") && (!a.city2.eql? nil)) %>,<%end%> 
        <%=a.city2 %> <% if ((!a.city3.eql? "") && (!a.city3.eql? nil)) %>,<%end%> 
        <%=a.city3 %> <% if ((!a.city4.eql? "") && (!a.city4.eql? nil)) %>,<%end%> 
        <%=a.city4 %> <% if ((!a.city5.eql? "") && (!a.city5.eql? nil)) %>,<%end%> 
        <%=a.city5 %> <% if ((!a.city6.eql? "") && (!a.city6.eql? nil)) %>,<%end%> 
        <%=a.city6 %> <% if ((!a.city7.eql? "") && (!a.city7.eql? nil)) %>,<%end%> 
        <%=a.city7 %> <% if ((!a.city8.eql? "") && (!a.city8.eql? nil)) %>,<%end%> 
        <%=a.city8 %> <% if ((!a.city9.eql? "") && (!a.city9.eql? nil)) %>,<%end%> 
        <%=a.city9 %> <% if ((!a.city10.eql? "") && (!a.city10.eql? nil)) %>,<%end%> 
        <%=a.city10 %><br>

      <b>Category:</b> 
        <%=a.category1 %> <% if ((!a.category2.eql? "") && (!a.category2.eql? nil)) %>,<%end%> 
        <%=a.category2 %> <% if ((!a.category3.eql? "") && (!a.category3.eql? nil)) %>,<%end%> 
        <%=a.category3 %> <% if ((!a.category4.eql? "") && (!a.category4.eql? nil)) %>,<%end%> 
        <%=a.category4 %> <% if ((!a.category5.eql? "") && (!a.category5.eql? nil)) %>,<%end%> 
        <%=a.category5 %> <% if ((!a.category6.eql? "") && (!a.category6.eql? nil)) %>,<%end%> 
        <%=a.category6 %> <% if ((!a.category7.eql? "") && (!a.category7.eql? nil)) %>,<%end%> 
        <%=a.category7 %> <% if ((!a.category8.eql? "") && (!a.category8.eql? nil)) %>,<%end%> 
        <%=a.category8 %> <% if ((!a.category9.eql? "") && (!a.category9.eql? nil)) %>,<%end%> 
        <%=a.category9 %> <% if ((!a.category10.eql? "") && (!a.category10.eql? nil)) %>,<%end%> 
        <%=a.category10 %> <% if ((!a.category11.eql? "") && (!a.category11.eql? nil)) %>,<%end%> 
        <%=a.category11 %> <% if ((!a.category12.eql? "") && (!a.category12.eql? nil)) %>,<%end%> 
        <%=a.category12 %> <% if ((!a.category13.eql? "") && (!a.category13.eql? nil)) %>,<%end%> 
        <%=a.category13 %> <% if ((!a.category14.eql? "") && (!a.category14.eql? nil)) %>,<%end%> 
        <%=a.category14 %> <% if ((!a.category15.eql? "") && (!a.category15.eql? nil)) %>,<%end%> 
        <%=a.category15 %> <% if ((!a.category16.eql? "") && (!a.category16.eql? nil)) %>,<%end%> 
        <%=a.category16 %> <% if ((!a.category17.eql? "") && (!a.category17.eql? nil)) %>,<%end%> 
        <%=a.category17 %> <% if ((!a.category18.eql? "") && (!a.category18.eql? nil)) %>,<%end%> 
        <%=a.category18 %> <% if ((!a.category19.eql? "") && (!a.category19.eql? nil)) %>,<%end%> 
        <%=a.category19 %> <% if ((!a.category20.eql? "") && (!a.category20.eql? nil)) %>,<%end%> 
        <%=a.category20 %> 
        <br>
      
      <%
          associated = Archive.where("ptype=?",a.old_id)
          associated_count = associated.count
          if (associated_count==0  && a.ptype != nil && a.ptype >0)
            associated = Archive.where("ptype=?",a.ptype)
            associated_count = associated.count
          end  
        %>
        <b>Associated Pages: </b><%=associated_count%>  
      
      </p>
        </div>
    </div>
   </div>
  </div>

<% end%>
<p align="center"><%= paginate @archives, window: 3 %></p>
<% end %>
</div>	
